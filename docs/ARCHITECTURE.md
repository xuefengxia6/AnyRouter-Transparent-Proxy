# AnyRouter é€æ˜ä»£ç† - æ¶æ„æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.1.0
> **æ›´æ–°æ—¥æœŸ**: 2025-12-10
> **æ¶æ„é£æ ¼**: æ¨¡å—åŒ–åˆ†å±‚æ¶æ„

---

## ğŸ“ æ•´ä½“æ¶æ„

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯è¯·æ±‚                              â”‚
â”‚                    (Claude Code CLI)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FastAPI åº”ç”¨å±‚                           â”‚
â”‚                      (backend/app.py)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ ç”Ÿå‘½å‘¨æœŸç®¡ç† (lifespan)                            â”‚   â”‚
â”‚  â”‚  â€¢ HTTP å®¢æˆ·ç«¯ç®¡ç† (httpx.AsyncClient)                â”‚   â”‚
â”‚  â”‚  â€¢ å¥åº·æ£€æŸ¥ç«¯ç‚¹ (/health)                             â”‚   â”‚
â”‚  â”‚  â€¢ ä¸»ä»£ç†è·¯ç”± (/{path:path})                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é…ç½®å±‚     â”‚  â”‚   æœåŠ¡å±‚     â”‚  â”‚   è·¯ç”±å±‚     â”‚
â”‚ (config.py) â”‚  â”‚ (services/)  â”‚  â”‚ (routers/)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
         â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”       â”‚
         â”‚       â”‚               â”‚       â”‚
         â”‚       â–¼               â–¼       â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚stats.py â”‚    â”‚proxy.py â”‚  â”‚
         â”‚  â”‚ç»Ÿè®¡æœåŠ¡  â”‚    â”‚ä»£ç†æœåŠ¡  â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚                               â”‚
         â”‚                               â–¼
         â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                        â”‚  admin.py   â”‚
         â”‚                        â”‚ Admin è·¯ç”±  â”‚
         â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸Šæ¸¸ API æœåŠ¡                            â”‚
â”‚                   (anyrouter.top)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ åˆ†å±‚æ¶æ„

### 1. åº”ç”¨å±‚ (Application Layer)
**æ–‡ä»¶**: `backend/app.py` (309 è¡Œ)

**èŒè´£**:
- FastAPI åº”ç”¨åˆå§‹åŒ–
- ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå¯åŠ¨/å…³é—­ï¼‰
- HTTP å®¢æˆ·ç«¯ç®¡ç†ï¼ˆè¿æ¥æ± ï¼‰
- è·¯ç”±æ³¨å†Œå’Œè¯·æ±‚åˆ†å‘
- å¥åº·æ£€æŸ¥ç«¯ç‚¹
- ä¸»ä»£ç†é€»è¾‘

**å…³é”®ç»„ä»¶**:
```python
# ç”Ÿå‘½å‘¨æœŸç®¡ç†
@asynccontextmanager
async def lifespan(_: FastAPI):
    # å¯åŠ¨ï¼šåˆå§‹åŒ– HTTP å®¢æˆ·ç«¯ã€å¯åŠ¨åå°ä»»åŠ¡
    yield
    # å…³é—­ï¼šæ¸…ç†èµ„æº

# FastAPI åº”ç”¨
app = FastAPI(lifespan=lifespan)

# è·¯ç”±æ³¨å†Œ
app.include_router(admin_router)

# ä¸»ä»£ç†è·¯ç”±
@app.api_route("/{path:path}", methods=[...])
async def proxy(path: str, request: Request):
    # ä»£ç†é€»è¾‘
```

**ä¾èµ–**:
- `config` - é…ç½®ç®¡ç†
- `services.stats` - ç»Ÿè®¡æœåŠ¡
- `services.proxy` - ä»£ç†æœåŠ¡
- `routers.admin` - Admin è·¯ç”±

---

### 2. é…ç½®å±‚ (Configuration Layer)
**æ–‡ä»¶**: `backend/config.py` (101 è¡Œ)

**èŒè´£**:
- ç¯å¢ƒå˜é‡åŠ è½½
- é…ç½®å¸¸é‡å®šä¹‰
- è‡ªå®šä¹‰è¯·æ±‚å¤´åŠ è½½
- é…ç½®éªŒè¯

**å…³é”®é…ç½®**:
```python
# åŸºç¡€é…ç½®
TARGET_BASE_URL = os.getenv("API_BASE_URL", "https://anyrouter.top")
DEBUG_MODE = os.getenv("DEBUG_MODE", "false").lower() in ("true", "1", "yes")
PORT = int(os.getenv("PORT", "8088"))

# System Prompt é…ç½®
SYSTEM_PROMPT_REPLACEMENT = os.getenv("SYSTEM_PROMPT_REPLACEMENT")
SYSTEM_PROMPT_BLOCK_INSERT_IF_NOT_EXIST = ...

# Dashboard é…ç½®
ENABLE_DASHBOARD = os.getenv("ENABLE_DASHBOARD", "false").lower() in (...)
DASHBOARD_API_KEY = os.getenv("DASHBOARD_API_KEY", "")

# è‡ªå®šä¹‰è¯·æ±‚å¤´
CUSTOM_HEADERS = load_custom_headers()
```

**ä¾èµ–**: æ— ï¼ˆåº•å±‚æ¨¡å—ï¼‰

---

### 3. æœåŠ¡å±‚ (Service Layer)

#### 3.1 ç»Ÿè®¡æœåŠ¡ (Statistics Service)
**æ–‡ä»¶**: `backend/services/stats.py` (270 è¡Œ)

**èŒè´£**:
- è¯·æ±‚ç»Ÿè®¡æ•°æ®æ”¶é›†
- æ€§èƒ½æŒ‡æ ‡è®¡ç®—
- é”™è¯¯æ—¥å¿—è®°å½•
- å®æ—¶æ—¥å¿—æµç®¡ç†
- æ—¶é—´çª—å£ç»Ÿè®¡

**å…³é”®åŠŸèƒ½**:
```python
# ç»Ÿè®¡æ•°æ®æ”¶é›†
async def record_request_start(path, method, bytes_sent) -> str
async def record_request_success(request_id, path, bytes_received, response_time)
async def record_request_error(request_id, path, error_msg, response_time)

# æ—¶é—´çª—å£ç»Ÿè®¡
async def update_time_window_stats()

# æ—¥å¿—æµç®¡ç†
async def broadcast_log_message(level, message, path, request_id)
async def log_producer()

# å·¥å…·å‡½æ•°
def format_bytes(bytes_count) -> str
def calculate_percentiles(values, percentiles) -> dict
async def get_time_filtered_data(start_time, end_time) -> Tuple
```

**å…¨å±€çŠ¶æ€**:
```python
# ç»Ÿè®¡æ•°æ®
request_stats = {...}
recent_requests = deque(maxlen=1000)
error_logs = deque(maxlen=500)
path_stats = defaultdict(...)
time_window_stats = {...}

# æ—¥å¿—æµ
log_subscribers = set()
log_queue = asyncio.Queue(maxsize=1000)
```

**ä¾èµ–**: æ— ï¼ˆåº•å±‚æ¨¡å—ï¼‰

---

#### 3.2 ä»£ç†æœåŠ¡ (Proxy Service)
**æ–‡ä»¶**: `backend/services/proxy.py` (190 è¡Œ)

**èŒè´£**:
- HTTP è¯·æ±‚å¤´è¿‡æ»¤
- HTTP å“åº”å¤´è¿‡æ»¤
- è¯·æ±‚ä½“å¤„ç†ï¼ˆSystem Prompt æ›¿æ¢ï¼‰
- è¯·æ±‚å¤´å‡†å¤‡ï¼ˆHostã€X-Forwarded-Forã€è‡ªå®šä¹‰å¤´ï¼‰

**å…³é”®åŠŸèƒ½**:
```python
# è¯·æ±‚å¤´è¿‡æ»¤
def filter_request_headers(headers: Iterable[tuple]) -> dict

# å“åº”å¤´è¿‡æ»¤
def filter_response_headers(headers: Iterable[tuple]) -> dict

# è¯·æ±‚ä½“å¤„ç†
def process_request_body(body: bytes) -> bytes

# è¯·æ±‚å¤´å‡†å¤‡
def prepare_forward_headers(incoming_headers, client_host) -> dict
```

**ä¾èµ–**:
- `config` - é…ç½®å¸¸é‡

---

### 4. è·¯ç”±å±‚ (Router Layer)

#### 4.1 Admin è·¯ç”± (Admin Router)
**æ–‡ä»¶**: `backend/routers/admin.py` (449 è¡Œ)

**èŒè´£**:
- Web ç®¡ç†é¢æ¿é™æ€æ–‡ä»¶æœåŠ¡
- Dashboard API ç«¯ç‚¹
- è®¤è¯å’Œæˆæƒ
- é…ç½®ç®¡ç† API
- ç»Ÿè®¡æ•°æ® API
- é”™è¯¯æ—¥å¿— API
- å®æ—¶æ—¥å¿—æµ SSE

**å…³é”®è·¯ç”±**:
```python
# é™æ€æ–‡ä»¶
@router.get("/admin")
@router.get("/admin/{path:path}")
async def admin_static(path: str = "")

# API ç«¯ç‚¹
@router.get("/api/admin/health")
@router.get("/api/admin/config")
@router.put("/api/admin/config")
@router.get("/api/admin/stats")
@router.get("/api/admin/errors")
@router.get("/api/admin/logs/stream")
@router.post("/api/admin/logs/broadcast")
```

**è®¤è¯**:
```python
async def verify_dashboard_api_key(credentials) -> bool
```

**ä¾èµ–**:
- `config` - é…ç½®å¸¸é‡
- `services.stats` - ç»Ÿè®¡æ•°æ®å’Œå‡½æ•°

---

## ğŸ”„ æ•°æ®æµ

### è¯·æ±‚å¤„ç†æµç¨‹

```
1. å®¢æˆ·ç«¯è¯·æ±‚
   â†“
2. FastAPI è·¯ç”±åŒ¹é…
   â†“
3. [Admin è·¯ç”±] â†’ admin.py å¤„ç† â†’ è¿”å›å“åº”
   æˆ–
   [ä»£ç†è·¯ç”±] â†’ ç»§ç»­ä¸‹ä¸€æ­¥
   â†“
4. è®°å½•è¯·æ±‚å¼€å§‹ (stats.record_request_start)
   â†“
5. å¤„ç†è¯·æ±‚ä½“ (proxy.process_request_body)
   â†“
6. å‡†å¤‡è¯·æ±‚å¤´ (proxy.prepare_forward_headers)
   â†“
7. å‘é€ä¸Šæ¸¸è¯·æ±‚ (httpx.AsyncClient)
   â†“
8. æµå¼è¯»å–å“åº”
   â†“
9. è¿‡æ»¤å“åº”å¤´ (proxy.filter_response_headers)
   â†“
10. æµå¼è¿”å›å®¢æˆ·ç«¯
   â†“
11. è®°å½•è¯·æ±‚å®Œæˆ (stats.record_request_success/error)
   â†“
12. å¹¿æ’­æ—¥å¿—æ¶ˆæ¯ (stats.broadcast_log_message)
```

### ç»Ÿè®¡æ•°æ®æµ

```
1. è¯·æ±‚å¼€å§‹ â†’ record_request_start()
   â†“
2. æ›´æ–°å…¨å±€ç»Ÿè®¡ (request_stats, path_stats)
   â†“
3. è¯·æ±‚å®Œæˆ â†’ record_request_success() / record_request_error()
   â†“
4. æ›´æ–°æ€§èƒ½æŒ‡æ ‡ (recent_requests, error_logs)
   â†“
5. å®šæœŸæ›´æ–°æ—¶é—´çª—å£ç»Ÿè®¡ (periodic_stats_update)
   â†“
6. Dashboard æŸ¥è¯¢ç»Ÿè®¡æ•°æ® (get_stats, get_errors)
   â†“
7. è¿”å›æ ¼å¼åŒ–çš„ç»Ÿè®¡ç»“æœ
```

### æ—¥å¿—æµ

```
1. ä»£ç†å‡½æ•°è®°å½•æ—¥å¿— â†’ broadcast_log_message()
   â†“
2. æ·»åŠ åˆ°æ—¥å¿—é˜Ÿåˆ— (log_queue)
   â†“
3. å¹¿æ’­ç»™æ‰€æœ‰è®¢é˜…è€… (log_subscribers)
   â†“
4. SSE è¿æ¥æ¥æ”¶æ—¥å¿— (stream_logs)
   â†“
5. å‰ç«¯å®æ—¶æ˜¾ç¤ºæ—¥å¿—
```

---

## ğŸ” å®‰å…¨è®¾è®¡

### 1. è®¤è¯å’Œæˆæƒ
- Dashboard API Key è®¤è¯ï¼ˆå¯é€‰ï¼‰
- HTTP Bearer Token æ–¹æ¡ˆ
- ç¯å¢ƒå˜é‡é…ç½® API Key

### 2. è¯·æ±‚å¤´å®‰å…¨
- è‡ªåŠ¨è¿‡æ»¤ hop-by-hop å¤´éƒ¨
- é˜²æ­¢ Host å¤´æ³¨å…¥
- è‡ªåŠ¨æ·»åŠ  X-Forwarded-For

### 3. èµ„æºç®¡ç†
- è¿æ¥æ± å¤ç”¨ï¼ˆhttpx.AsyncClientï¼‰
- è¯·æ±‚è¶…æ—¶ï¼ˆ60 ç§’ï¼‰
- æµå¼å“åº”ï¼ˆé¿å…å†…å­˜æº¢å‡ºï¼‰
- BackgroundTask è‡ªåŠ¨æ¸…ç†èµ„æº

### 4. é”™è¯¯å¤„ç†
- ä¸Šæ¸¸è¯·æ±‚å¤±è´¥è¿”å› 502
- å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ä¼˜é›…å¤„ç†
- å¼‚å¸¸æ—¥å¿—è®°å½•

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å¼‚æ­¥æ¶æ„
- åŸºäº asyncio çš„å¼‚æ­¥ I/O
- å¼‚æ­¥ HTTP å®¢æˆ·ç«¯ï¼ˆhttpxï¼‰
- å¼‚æ­¥æµå¼å“åº”

### 2. è¿æ¥æ± å¤ç”¨
- å…¨å±€å…±äº« httpx.AsyncClient
- è‡ªåŠ¨ç®¡ç†è¿æ¥ç”Ÿå‘½å‘¨æœŸ
- å‡å°‘è¿æ¥å»ºç«‹å¼€é”€

### 3. æµå¼ä¼ è¾“
- é›¶æ‹·è´æµå¼è½¬å‘
- é¿å…å†…å­˜ç¼“å†²
- æ”¯æŒå¤§æ–‡ä»¶ä¼ è¾“

### 4. ç»Ÿè®¡æ•°æ®ä¼˜åŒ–
- ä½¿ç”¨ deque é™åˆ¶å†…å­˜å ç”¨
- å¼‚æ­¥é”ä¿è¯çº¿ç¨‹å®‰å…¨
- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•
- é…ç½®åŠ è½½æµ‹è¯•
- è¯·æ±‚å¤´è¿‡æ»¤æµ‹è¯•
- è¯·æ±‚ä½“å¤„ç†æµ‹è¯•
- ç»Ÿè®¡æ•°æ®è®¡ç®—æµ‹è¯•

### 2. é›†æˆæµ‹è¯•
- ç«¯åˆ°ç«¯ä»£ç†æµ‹è¯•
- Dashboard API æµ‹è¯•
- å®æ—¶æ—¥å¿—æµæµ‹è¯•

### 3. æ€§èƒ½æµ‹è¯•
- å¹¶å‘è¯·æ±‚æµ‹è¯•
- æµå¼å“åº”æµ‹è¯•
- å†…å­˜æ³„æ¼æµ‹è¯•

---

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### 1. ç»Ÿè®¡æŒ‡æ ‡
- æ€»è¯·æ±‚æ•°ã€æˆåŠŸæ•°ã€å¤±è´¥æ•°
- å“åº”æ—¶é—´ï¼ˆP50ã€P95ã€P99ï¼‰
- QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰
- å­—èŠ‚ä¼ è¾“é‡

### 2. æ—¥å¿—çº§åˆ«
- INFO: æ­£å¸¸è¯·æ±‚æ—¥å¿—
- WARNING: å®¢æˆ·ç«¯æ–­å¼€è¿æ¥
- ERROR: ä¸Šæ¸¸è¯·æ±‚å¤±è´¥

### 3. å®æ—¶ç›‘æ§
- SSE å®æ—¶æ—¥å¿—æµ
- æ—¶é—´çª—å£ç»Ÿè®¡å›¾è¡¨
- é”™è¯¯æ—¥å¿—æŸ¥è¯¢

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### Docker éƒ¨ç½²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Docker Container                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend (Vue 3 SPA)             â”‚  â”‚
â”‚  â”‚  /app/static/                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Backend (FastAPI)                â”‚  â”‚
â”‚  â”‚  /app/backend/                    â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ app.py                     â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ config.py                  â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ services/                  â”‚  â”‚
â”‚  â”‚    â””â”€â”€ routers/                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚  Port: 8088 (configurable)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç½‘ç»œæ¨¡å¼
- **host æ¨¡å¼**: ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼ˆLinuxï¼‰
- **bridge æ¨¡å¼**: ç«¯å£æ˜ å°„ï¼ˆmacOS/Windowsï¼‰

---

## ğŸ“š æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°è·¯ç”±
1. åœ¨ `backend/routers/` åˆ›å»ºæ–°æ–‡ä»¶
2. å®šä¹‰ `APIRouter` å®ä¾‹
3. åœ¨ `app.py` ä¸­æ³¨å†Œè·¯ç”±

```python
# backend/routers/new_router.py
from fastapi import APIRouter

router = APIRouter()

@router.get("/api/new/endpoint")
async def new_endpoint():
    return {"message": "Hello"}

# backend/app.py
from .routers.new_router import router as new_router
app.include_router(new_router)
```

### æ·»åŠ æ–°æœåŠ¡
1. åœ¨ `backend/services/` åˆ›å»ºæ–°æ–‡ä»¶
2. å®šä¹‰æœåŠ¡å‡½æ•°
3. åœ¨éœ€è¦çš„åœ°æ–¹å¯¼å…¥ä½¿ç”¨

```python
# backend/services/new_service.py
async def new_service_function():
    # æœåŠ¡é€»è¾‘
    pass

# backend/app.py
from .services.new_service import new_service_function
```

---

## ğŸ¯ æ¶æ„åŸåˆ™

### SOLID åŸåˆ™
- âœ… **S**ingle Responsibility - å•ä¸€èŒè´£
- âœ… **O**pen/Closed - å¼€é—­åŸåˆ™
- âœ… **L**iskov Substitution - é‡Œæ°æ›¿æ¢
- âœ… **I**nterface Segregation - æ¥å£éš”ç¦»
- âœ… **D**ependency Inversion - ä¾èµ–å€’ç½®

### å…¶ä»–åŸåˆ™
- âœ… **KISS** - ç®€å•è‡³ä¸Š
- âœ… **DRY** - é¿å…é‡å¤
- âœ… **YAGNI** - ä½ ä¸éœ€è¦å®ƒ

---

**æ¶æ„è®¾è®¡å®Œæˆï¼æ¸…æ™°ã€ç®€æ´ã€æ˜“äºç»´æŠ¤å’Œæ‰©å±•ï¼** (ï¿£â–½ï¿£)ãƒ

---

**Â© 2024 AnyRouter Transparent Proxy | MIT License**
